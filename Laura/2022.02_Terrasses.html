<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Terrazas Barcelona</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.css' rel='stylesheet' />
<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.0.0/mapbox-gl-geocoder.min.js'></script>
<link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.0.0/mapbox-gl-geocoder.css' type='text/css' />
<script src='https://cdn.rawgit.com/duroty/responsive/master/app.embed.js'></script>

<style>
  body { margin: 0; padding: 0; }
  #map { position: absolute; top: 0; bottom: 0; width: 100%; }
</style>
</head>
<body>
<style>
 @import url('https://fonts.googleapis.com/css?family=Open+Sans:200,400,600,700,800');

body {
overflow: hidden;
height: 650px;
}
 
body * {
-webkit-touch-callout: none;
-webkit-user-select: none;
-moz-user-select: none;
-ms-user-select: none;
user-select: none;
}
 
.map {
position: absolute;
top: 0;
bottom: 0;
width: 100%;
}


.legend {
  background-color: #ffffff;
    border-radius: 3px;
    bottom: 10px;
    padding: 7px;
    position: absolute;
    right: 10px;
    z-index: 1;
    width: 200px;
    text-align: center;
    box-shadow: 0 0 10px 2px rgba(0,0,0,.1);
}

.legend clearfix {
    background-color: #ffffff;
    border-radius: 3px;
    bottom: 10px;
    padding: 7px 10px 8px 5px;
    position: absolute;
    right: 0px;
    z-index: 1;
    width: 200px;
    text-align: left;
    box-shadow: 0 0 10px 2px rgba(0,0,0,.1);
}
.legend h1 {
    font-size: 10px;
    font-family: OpenSans-Semibold, Open Sans;
    font-weight: 600;
    fill: #aeaeaf;
    margin: 0px 0 -11px 0;
    text-transform: uppercase;
    text-align: left;
}
.legend span {
    float: left;
    height: 10px;
    width: 15.9%;
    font-size: 9px;
    color: #aeaeaf;
    margin-bottom: 5px;
}

.legend label {
    font-size: 10px;
    font-family: OpenSans-Semibold, Open Sans;
    fill: #aeaeaf;
    padding: 0 5px;
    text-align: left;


}
</style>
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-compare/v0.4.0/mapbox-gl-compare.js"></script>
<link
rel="stylesheet"
href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-compare/v0.4.0/mapbox-gl-compare.css"
type="text/css"
/>
      

<div id="comparison-container">
<div id="before" class="map"></div>
<div id="after" class="map"><div id='legend'>

 



<script>




mapboxgl.accessToken = 'pk.eyJ1IjoibGF1cjA1IiwiYSI6ImNpbmtmM2FjazAwODF2eG0yNjhteTcxdHIifQ.l7uzjVe2b1L8dHh_Z9JjoQ';
var beforeMap = new mapboxgl.Map({
container: 'before', // container id
style: 'mapbox://styles/laur05/ckusajnmp54yy17pjowjqvd73', 
center:  [2.1690278424226475, 41.395790633332325], // starting position [lng, lat]
zoom: 13,// starting zoom
minZoom: 5,
maxZoom: 20,
attributionControl: false,
//maxBounds: [[-1.5,35.5],[4.5,45] ]
});
var searched_lngLat = null;
var hoveredStateId =  null;


beforeMap.on('load', function () {
// Add a layer showing the state polygons.


beforeMap.addSource("resultados", {
    type: 'vector',
    url: 'mapbox://laur05.c6srwcmv',
});

beforeMap.addSource("distritos1", {
    type: 'vector',
    url: 'mapbox://laur05.8sfro8fo',
});

var layers = beforeMap.getStyle().layers;
// Find the index of the first symbol layer in the map style

beforeMap.addLayer({
                'id': 'circulos-antes',
                'type': 'circle',
                'source': 'resultados',
                'source-layer': 'Antes',
                'filter': ["all",
                	['>', 'TAULES', 0]
                ],
                'paint': {
                  'circle-radius': {
                  property: 'TAULES',
                  stops: [
                  [{zoom: 13, value: 0}, 0],
                  [{zoom: 13, value: 1}, 2],
                  [{zoom: 13, value: 4}, 2],
                  [{zoom: 13, value: 5}, 5],
                  [{zoom: 13, value: 10}, 5],
                  [{zoom: 13, value: 11}, 8],
                  [{zoom: 13, value: 20}, 8],
                  [{zoom: 13, value: 30}, 10],
                  [{zoom: 13, value: 49}, 10],
                  [{zoom: 13, value: 50}, 12],
                  [{zoom: 13, value: 124}, 12],
                  [{zoom: 13, value: 125}, 15],
                  [{zoom: 13, value: 267}, 15],
                  [{zoom: 13, value: 268}, 20],

                  [{zoom: 15, value: 0}, 0],
                  [{zoom: 15, value: 1}, 7],
                  [{zoom: 15, value: 5}, 7],
                  [{zoom: 15, value: 6}, 10],
                  [{zoom: 15, value: 10}, 10],
                  [{zoom: 15, value: 11}, 13],
                  [{zoom: 15, value: 20}, 13],
                  [{zoom: 15, value: 30}, 15],
                  [{zoom: 15, value: 49}, 15],
                  [{zoom: 15, value: 50}, 17],
                  [{zoom: 15, value: 124}, 17],
                  [{zoom: 15, value: 125}, 20],
                  [{zoom: 15, value: 267}, 20],
                  [{zoom: 15, value: 268}, 25],

                  [{zoom: 20, value: 0}, 0],
                  [{zoom: 20, value: 1}, 7],
                  [{zoom: 20, value: 5}, 7],
                  [{zoom: 20, value: 6}, 10],
                  [{zoom: 20, value: 10}, 10],
                  [{zoom: 20, value: 11}, 15],
                  [{zoom: 20, value: 20}, 15],
                  [{zoom: 20, value: 30}, 20],
                  [{zoom: 20, value: 49}, 20],
                  [{zoom: 20, value: 50}, 25],
                  [{zoom: 20, value: 124}, 25],
                  [{zoom: 20, value: 125}, 30],
                  [{zoom: 20, value: 267}, 30],
                  [{zoom: 20, value: 268}, 40],

                  ]
                  },
                  'circle-color': ["interpolate", ["linear"], ['number',["get", "TAULES"]],
                        1, "#bfd3e6",
                        9, "#bfd3e6",
                        10, "#9ebcda",
                        24, "#9ebcda",
                        25, "#8c96c6",
                        49, "#8c96c6",
                        50, "#88419d",
                        99, "#88419d",
                        100, "#810f7c",
                        149, "#810f7c",
                        150, "#4d004b"],

                'circle-opacity': ["case", ["boolean", ["feature-state", "hover"], false], 1, 0.8],
                'circle-stroke-color': ["case", ["boolean", ["feature-state", "hover"], false], "black", "white"],
                'circle-stroke-width': 0.5


              }}, "road-label");


beforeMap.addLayer({
    'id': 'tiles-borders',
    'type': 'line',
    'renderingMode': '2d',
    'source': 'distritos1',
    'source-layer': 'Barcelona',
    'paint': {
    "line-color": '#949494',
     "line-width": 0.5
}}, "road-label");


// Add zoom and rotation controls to the map.
var nav = new mapboxgl.NavigationControl( {showCompass:false});
beforeMap.addControl(nav, 'bottom-left');

// disable map zoom when using scroll
beforeMap.scrollZoom.disable();


var geocoder = new MapboxGeocoder({
countries: 'es',
accessToken: mapboxgl.accessToken,
mapboxgl: mapboxgl,
types: 'place',
placeholder: 'Busca tu calle',
zoom: 13,
});


beforeMap.addControl(geocoder, 'top-left');

beforeMap.addSource("distritos", {
    type: 'vector',
    url: 'mapbox://laur05.8sfro8fo',
});

var popup = new mapboxgl.Popup({
                closeButton: false,
                closeOnClick: false,
              }); 


              geocoder.on('result', function(ev) {
                searched_lngLat = mapboxgl.LngLat.convert(ev.result.center)      
              });

   beforeMap.on('mousemove', 'circulos-antes', function(e) {
                if (e.features.length > 0) {
                  if (hoveredStateId) {          
                    beforeMap.setFeatureState({ source: 'resultados', 
                      sourceLayer: 'Antes',
                      id: hoveredStateId}, { hover: false});
                  }
                  hoveredStateId = e.features[0].id;
                  beforeMap.setFeatureState({ source: 'resultados', 
                  sourceLayer: 'Antes',
                    id: hoveredStateId}, { hover: true});
                }
                beforeMap.getCanvas().style.cursor = 'pointer';

                      //var coordinates = e.features[0].geometry.coordinates.slice();
                      var villa = e.features[0].properties.EMPLACAMENT.toLocaleString('es');
                      var CADIRES = e.features[0].properties.CADIRES.toLocaleString('es');
                      var TAULES = e.features[0].properties.TAULES.toLocaleString('es');

                      popup.setLngLat(e.lngLat)
                      .setHTML("<div style='color:#810f7c;font-size:12px;font-family: OpenSans-bold, Open Sans;padding-bottom:3px'><b>" + villa + "</b></div><hr><div style='padding-top: 4px; font-size: 14px;font-family: Open Sans;text-align: center;'><b style ='color:#323232;'>" + TAULES + " </b> mesas y <b>" + CADIRES + "</b> sillas")
                      .addTo(beforeMap);
              });   
        // Change the cursor style as a UI indicator.

        
        // Display a popup with the name of the county


 beforeMap.on('mouseleave', 'circulos-antes', function() {
                beforeMap.getCanvas().style.cursor = '';
                popup.remove();
                if (hoveredStateId) {          
                  beforeMap.setFeatureState({ source: 'resultados', 
                    sourceLayer: 'Antes',
                    id: hoveredStateId}, { hover: false});
                }
                hoveredStateId = null;
              });    

});  

var afterMap = new mapboxgl.Map({
container: 'after', // container id
style: 'mapbox://styles/laur05/ckusajnmp54yy17pjowjqvd73', 
center:  [2.1690278424226475, 41.395790633332325], // starting position [lng, lat]
zoom: 13,// starting zoom
minZoom: 5,
maxZoom: 20,
attributionControl: false,
//maxBounds: [[-1.5,35.5],[4.5,45] ]
});
var hoveredStateId =  null;
var searched_lngLat = null;


afterMap.on('load', function () {
// Add a layer showing the state polygons.


afterMap.addSource("resultados2", {
    type: 'vector',
    url: 'mapbox://laur05.5fv5u5d8',
});

afterMap.addSource("distritos", {
    type: 'vector',
    url: 'mapbox://laur05.8sfro8fo',
});


var layers = afterMap.getStyle().layers;
// Find the index of the first symbol layer in the map style

afterMap.addLayer({
  'id': 'circulos-despues',
                'type': 'circle',
                'renderingMode': '2d',
                'source': 'resultados2',
                'source-layer': 'Despues',
                'filter': ["all",
                	['>', 'TAULES', 0]
                ],
                'paint': {
                  'circle-radius': {
                  property: 'TAULES',
                  stops: [
                  [{zoom: 13, value: 0}, 0],
                  [{zoom: 13, value: 1}, 2],
                  [{zoom: 13, value: 4}, 2],
                  [{zoom: 13, value: 5}, 5],
                  [{zoom: 13, value: 10}, 5],
                  [{zoom: 13, value: 11}, 8],
                  [{zoom: 13, value: 20}, 8],
                  [{zoom: 13, value: 30}, 10],
                  [{zoom: 13, value: 49}, 10],
                  [{zoom: 13, value: 50}, 12],
                  [{zoom: 13, value: 124}, 12],
                  [{zoom: 13, value: 125}, 15],
                  [{zoom: 13, value: 267}, 15],
                  [{zoom: 13, value: 268}, 20],

                  [{zoom: 15, value: 0}, 0],
                  [{zoom: 15, value: 1}, 7],
                  [{zoom: 15, value: 5}, 7],
                  [{zoom: 15, value: 6}, 10],
                  [{zoom: 15, value: 10}, 10],
                  [{zoom: 15, value: 11}, 13],
                  [{zoom: 15, value: 20}, 13],
                  [{zoom: 15, value: 30}, 15],
                  [{zoom: 15, value: 49}, 15],
                  [{zoom: 15, value: 50}, 17],
                  [{zoom: 15, value: 124}, 17],
                  [{zoom: 15, value: 125}, 20],
                  [{zoom: 15, value: 267}, 20],
                  [{zoom: 15, value: 268}, 25],

                  [{zoom: 20, value: 0}, 0],
                  [{zoom: 20, value: 1}, 7],
                  [{zoom: 20, value: 5}, 7],
                  [{zoom: 20, value: 6}, 10],
                  [{zoom: 20, value: 10}, 10],
                  [{zoom: 20, value: 11}, 15],
                  [{zoom: 20, value: 20}, 15],
                  [{zoom: 20, value: 30}, 20],
                  [{zoom: 20, value: 49}, 20],
                  [{zoom: 20, value: 50}, 25],
                  [{zoom: 20, value: 124}, 25],
                  [{zoom: 20, value: 125}, 30],
                  [{zoom: 20, value: 267}, 30],
                  [{zoom: 20, value: 268}, 40],

                  ]
                  },

                 
                  'circle-color': ["interpolate", ["linear"], ['number',["get", "TAULES"]],
                        1, "#fcbba1",
                        9, "#fcbba1",
                        10, "#fc9272",
                        24, "#fc9272",
                        25, "#ef3b2c",
                        49, "#ef3b2c",
                        50, "#cb181d",
                        99, "#cb181d",
                        100, "#a50f15",
                        149, "#a50f15",
                        150, "#67000d"],
                
                'circle-opacity': ["case", ["boolean", ["feature-state", "hover"], false], 1, 0.8],
                'circle-stroke-color': ["case", ["boolean", ["feature-state", "hover"], false], "black", "white"],
                'circle-stroke-width': 0.5

              }}, "road-label");


afterMap.addLayer({
    'id': 'tiles-borders',
    'type': 'line',
    'renderingMode': '2d',
    'source': 'distritos',
    'source-layer': 'Barcelona',
    'paint': {
    "line-color": '#949494',
     "line-width": 0.5,
     
}}, "road-label");




// Add zoom and rotation controls to the map.
var nav = new mapboxgl.NavigationControl( {showCompass:false});
afterMap.addControl(nav, 'bottom-left');

// disable map zoom when using scroll
afterMap.scrollZoom.disable();


var geocoder = new MapboxGeocoder({
countries: 'es',
accessToken: mapboxgl.accessToken,
mapboxgl: mapboxgl,
types: 'place',
placeholder: 'Busca tu municipio',
zoom: 7,
});


afterMap.addControl(geocoder, 'top-left');

var popup = new mapboxgl.Popup({
                closeButton: false,
                closeOnClick: false,
              }); 


              geocoder.on('result', function(ev) {
                searched_lngLat = mapboxgl.LngLat.convert(ev.result.center)      
              });

   afterMap.on('mousemove', 'circulos-despues', function(e) {
                if (e.features.length > 0) {
                  if (hoveredStateId) {          
                    afterMap.setFeatureState({ source: 'resultados2', 
                      sourceLayer: 'Despues',
                      id: hoveredStateId}, { hover: false});
                  }
                  hoveredStateId = e.features[0].id;
                  afterMap.setFeatureState({ source: 'resultados2', 
                    sourceLayer: 'Despues',
                    id: hoveredStateId}, { hover: true});
                }
                afterMap.getCanvas().style.cursor = 'pointer';

                      //var coordinates = e.features[0].geometry.coordinates.slice();
                      var villa = e.features[0].properties.EMPLACAMENT.toLocaleString('es-ES');
                      var TAULES = e.features[0].properties.TAULES.toLocaleString('es');
                      var CADIRES = e.features[0].properties.CADIRES.toLocaleString('es-ES');
                      var PerCovid = e.features[0].properties.PerCovid.toLocaleString('es', {maximumFractionDigits: 2});


                      popup.setLngLat(e.lngLat)
                      .setHTML("<div style='color:#cb181d;font-size:12px;font-family: OpenSans-bold, Open Sans;padding-bottom:3px'><b>" + villa + "</b></div><hr><div style='padding-top: 4px; font-size: 14px;font-family: Open Sans;text-align: center;'><b style ='color:#323232;'>" + TAULES + " </b> mesas y <b>" + CADIRES + "</b> sillas, de las cuales un <b>" + PerCovid + "</b>% son provisionales</div>")
                      .addTo(afterMap);
              });   
        // Change the cursor style as a UI indicator.

        
        // Display a popup with the name of the county


 afterMap.on('mouseleave', 'circulos-despues', function() {
                afterMap.getCanvas().style.cursor = '';
                popup.remove();
                if (hoveredStateId) {          
                  afterMap.setFeatureState({ source: 'resultados2', 
                    sourceLayer: 'Despues',
                    id: hoveredStateId}, { hover: false});
                }
                hoveredStateId = null;
              });    

});  

var container = '#comparison-container';
 
var map = new mapboxgl.Compare(beforeMap, afterMap, container, {

// Set this to enable comparing two maps by mouse movement:
// mousemove: true
});
</script>
 

   
	</body>
</html>
