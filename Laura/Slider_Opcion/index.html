
<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>Mapbox</title>
<meta name=viewport content='initial-scale=1,maximum-scale=1,user-scalable=no'/>
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.css' rel=stylesheet />
<script src="https://unpkg.com/intersection-observer@0.5.1/intersection-observer.js"></script>
<script src="https://unpkg.com/scrollama"></script>
<script type="text/javascript" src="https://aesqe.github.io/mapboxgl-minimap/mapboxgl-control-minimap.js"></script>
<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.0.0/mapbox-gl-geocoder.min.js'></script>
<link rel=stylesheet href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.0.0/mapbox-gl-geocoder.css' type='text/css'/>
<script src="https://cdn.rawgit.com/duroty/responsive/master/app.embed.js"></script>
<link rel=stylesheet href=global.css />
</head>
<body>
<div id=intro>
<h1>Rentas altas a un lado y bajas al otro: los muros económicos entre vecinos</h1>
<h2>En las ciudades españolas, autopistas, vías de tren y ríos segregan el territorio y separan barrios ricos y pobres</h2>
<p id=autor>Clara Penín y Laura Aragó</p>
</div>
<div id=map>
</div>
<div id=story></div>
<script src="./config.js"></script>
<script>

var totalWidth = window.innerWidth;
var isMobile = totalWidth < 400;

        var layerTypes = {
            'fill': ['fill-opacity'],
            'line': ['line-opacity'],
            'circle': ['circle-opacity', 'circle-stroke-opacity'],
            'symbol': ['icon-opacity', 'text-opacity'],
            'raster': ['raster-opacity'],
            'fill-extrusion': ['fill-extrusion-opacity'],
            'heatmap': ['heatmap-opacity']
        }

        var alignments = {
            'left': 'lefty',
            'center': 'centered',
            'right': 'righty',
            'full': 'fully'
        }

        function getLayerPaintType(layer) {
            var layerType = map.getLayer(layer).type;
            return layerTypes[layerType];
        }

        function setLayerOpacity(layer) {
            var paintProps = getLayerPaintType(layer.layer);
            paintProps.forEach(function (prop) {
                var options = {};
                if (layer.duration) {
                    var transitionProp = prop + "-transition";
                    options = { "duration": layer.duration };
                    map.setPaintProperty(layer.layer, transitionProp, options);
                }
                map.setPaintProperty(layer.layer, prop, layer.opacity, options);
            });
        }

        var story = document.getElementById('story');
        var features = document.createElement('div');
        features.setAttribute('id', 'features');

        var header = document.createElement('div');

        if (config.title) {
            var titleText = document.createElement('h1');
            titleText.innerText = config.title;
            header.appendChild(titleText);
        }

        if (config.subtitle) {
            var subtitleText = document.createElement('h2');
            subtitleText.innerText = config.subtitle;
            header.appendChild(subtitleText);
        }

        if (config.byline) {
            var bylineText = document.createElement('p');
            bylineText.innerText = config.byline;
            header.appendChild(bylineText);
        }

        if (header.innerText.length > 0) {
            header.classList.add(config.theme);
            header.setAttribute('id', 'header');
            story.appendChild(header);
        }

        config.chapters.forEach((record, idx) => {
            var container = document.createElement('div');
            var chapter = document.createElement('div');

            if (record.title) {
                var title = document.createElement('h3');
                title.innerText = record.title;
                chapter.appendChild(title);
            }

            if (record.image) {
                var image = new Image();
                image.src = record.image;
                chapter.appendChild(image);
            }

            if (record.description) {
                var story = document.createElement('p');
                story.innerHTML = record.description;
                chapter.appendChild(story);
            }

            container.setAttribute('id', record.id);
            container.classList.add('step');
            if (idx === 0) {
                container.classList.add('active');
            }

            chapter.classList.add(config.theme);
            container.appendChild(chapter);
            container.classList.add(alignments[record.alignment] || 'centered');
            if (record.hidden) {
                container.classList.add('hidden');
            }
            features.appendChild(container);
        });

        story.appendChild(features);

        var footer = document.createElement('div');

        if (config.footer) {
            var footerText = document.createElement('p');
            footerText.innerHTML = config.footer;
            footer.appendChild(footerText);
        }

        if (footer.innerText.length > 0) {
            footer.classList.add(config.theme);
            footer.setAttribute('id', 'footer');
            story.appendChild(footer);
        }

        mapboxgl.accessToken = config.accessToken;

        const transformRequest = (url) => {
            const hasQuery = url.indexOf("?") !== -1;
            const suffix = hasQuery ? "&pluginName=scrollytellingV2" : "?pluginName=scrollytellingV2";
            return {
                url: url + suffix
            }
        }

        var map = new mapboxgl.Map({
            container: 'map',
            style: config.style,
            center: config.chapters[0].location.center,
            zoom: config.chapters[0].location.zoom,
            bearing: config.chapters[0].location.bearing,
            pitch: config.chapters[0].location.pitch,
            interactive: false,
            transformRequest: transformRequest
        });

        if (config.showMarkers) {
            var marker = new mapboxgl.Marker({ color: config.markerColor });
            marker.setLngLat(config.chapters[0].location.center).addTo(map);
        }

        // instantiate the scrollama
        var scroller = scrollama();

        map.on("load", function () {
            map.addSource("alquileres", {
                type: 'vector',
                //url: 'mapbox://laur05.62kefux9',
            });


            map.addSource("Onyar", {
                type: 'geojson',
                data: {
                    "type": "Feature",
                    "geometry": {
                        "type": "LineString",
                        "coordinates": [
                        
                    [
                        2.8242629492953313,
                        41.99718008379995
                    ],
                    [
                        2.8242851457699203,
                        41.99677318299666
                    ],
                    [
                        2.824632890529301,
                        41.99620131801021
                    ],
                    [
                        2.824988034113886,
                        41.99527752525452
                    ],
                    [
                        2.8253000646806754,
                        41.99459090167889
                    ],
                    [
                        2.8253740529276286,
                        41.99423897330567
                    ],
                    [
                        2.8253814517528326,
                        41.99412899528946
                    ],
                    [
                        2.8253715011821328,
                        41.99344733822454
                    ],
                    [
                        2.8252235246891644,
                        41.99273796785968
                    ],
                    [
                        2.8247573987335954,
                        41.992144070310616
                    ],
                    [
                        2.824119067790093,
                        41.991653505867134
                    ],
                    [
                        2.8234827688679047,
                        41.991032102340114
                    ],
                    [
                        2.8233273935497323,
                        41.99057566933624
                    ],
                    [
                        2.8232176098466653,
                        41.98964733567544
                    ],
                    [
                        2.8232841984186337,
                        41.98886169874572
                    ],
                    [
                        2.823506163158669,
                        41.98790480280934
                    ],
                    [
                        2.824223845088369,
                        41.986305321174115
                    ],
                    [
                        2.8243792204065414,
                        41.986002843475916
                    ],
                    [
                        2.8244166017505847,
                        41.98566561331924
                    ],
                    [
                        2.824342613503603,
                        41.98538513123003
                    ],
                    [
                        2.8238983126877315,
                        41.984524423520554
                    ],
                    [
                        2.8235801632271205,
                        41.983798454325125
                    ],
                    [
                        2.823379188885923,
                        41.98310615648916
                    ],
                    [
                        2.8233273971125357,
                        41.98223167309567
                    ],
                    [
                        2.8234446161110327,
                        41.981374433442795
                    ],
                    [
                        2.8239012781652946,
                        41.98033069421629
                    ],
                    [
                        2.8240196593595215,
                        41.98002268800991
                    ],
                    [
                        2.82416023519076,
                        41.97922253394188
                    ],
                    [
                        2.824175032840145,
                        41.97870551367848
                    ],
                    [
                        2.8238262444171482,
                        41.97742634522115
                    ],
                    [
                        2.823619077326498,
                        41.97698631583083
                    ],
                    [
                        2.823587776982464,
                        41.976551827228576
                    ],
                    [
                        2.823632169930619,
                        41.97623280184263
                    ],
                    [
                        2.8238058185681325,
                        41.97580249976647
                    ],
                    [
                        2.82418315862634,
                        41.975268950135046
                    ],
                    [
                        2.8245530998603385,
                        41.975021425591876
                    ],
                    [
                        2.8258552872540292,
                        41.97450987047171
                    ],
                    [
                        2.82675054504017,
                        41.974163331712305
                    ],
                    [
                        2.8283042943967303,
                        41.973789287847296
                    ],
                    [
                        2.8304291595844973,
                        41.973822292889565
                    ],
                    [
                        2.8312429445810494,
                        41.97366370081676
                    ],
                    [
                        2.832736388251078,
                        41.972915507774815
                    ],
                    [
                        2.8333129765761385,
                        41.97272863650835
                    ],
                    [
                        2.8339122813753477,
                        41.972662627424825
                    ],
                    [
                        2.834674360316882,
                        41.972684630460236
                    ],
                    [
                        2.835081295674854,
                        41.97262962285737
                    ],
                    [
                        2.83594459031778,
                        41.972003566262316
                    ],
                    [
                        2.8363441265160816,
                        41.970760131223386
                    ],
                    [
                        2.836201094139227,
                        41.969826746555555
                    ],
                    [
                        2.836289880035565,
                        41.96949668541802
                    ],
                    [
                        2.8365488388995743,
                        41.969276643709776
                    ],
                    [
                        2.8369853695552933,
                        41.969133616191385
                    ],
                    [
                        2.837436697860511,
                        41.96911711299589
                    ],
                    [
                        2.8380512688380577,
                        41.96927623301846
                    ],
                    [
                        2.8385099959674562,
                        41.96928723512195
                    ],
                    [
                        2.8390501101690404,
                        41.96912770443461
                    ],
                    [
                        2.83944224787669,
                        41.969083695898746
                    ],
                    [
                        2.8403604462362466,
                        41.969232042030484
                    ],
                    [
                        2.8408783639641797,
                        41.969221039917386
                    ],
                    [
                        2.8412039122499664,
                        41.9693200588662
                    ],
                    [
                        2.842572687796064,
                        41.969358553568725
                    ],
                    [
                        2.844091037561327,
                        41.968703795501284
                    ],
                    [
                        2.844298204651949,
                        41.968709296602384
                    ],
                    [
                        2.8448310895960276,
                        41.96833522135333
                    ],
                    [
                        2.8453204091427153,
                        41.967513314148334
                    ],
                    [
                        2.845249481675438,
                        41.967307207383186
                    ],
                    [
                        2.8443943087653167,
                        41.966765542191325
                    ],
                    [
                        2.84369881924556,
                        41.966374950891236
                    ],
                    [
                        2.8432400921151952,
                        41.966033869205546
                    ],
                    [
                        2.842018016846083,
                        41.96548581115704
                    ],
                    [
                        2.8414409085205534,
                        41.965304265372794
                    ],
                    [
                        2.8410857649369063,
                        41.96506220352268
                    ],
                    [
                        2.8408785978453466,
                        41.96482014075289
                    ],
                    [
                        2.840831108322618,
                        41.96441662164938
                    ],
                    [
                        2.8409124953947185,
                        41.96410303698062
                    ],
                    [
                        2.8407935324357823,
                        41.963654138198194
                    ],
                    [
                        2.8408157289103713,
                        41.96305996935453
                    ],
                    [
                        2.8410426012045775,
                        41.961100701150855
                    ],
                    [
                        2.841368149490364,
                        41.960770594803904
                    ],
                    [
                        2.841530923632803,
                        41.960534017537185
                    ],
                    [
                        2.8415827154061617,
                        41.960291937563994
                    ],
                    [
                        2.841530923632803,
                        41.96008836960172
                    ],
                    [
                        2.840615469036635,
                        41.95892308599156
                    ],
                    [
                        2.840199715274764,
                        41.95756664610548
                    ],
                    [
                        2.8402071140990017,
                        41.956796352585116
                    ],
                    [
                        2.839931327472584,
                        41.956118997111304
                    ],
                    [
                        2.839184046180378,
                        41.95476544441473
                    ]
                
                ]
                    }
                }
            });

            map.addSource("Girona", {
                type: 'geojson',
                data: {
            "type": "Feature",
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                        [
                            2.8179931640625,
                            41.94065887682254
                        ],
                        [
                            2.816190719604492,
                            41.94199958840625
                        ],
                        [
                            2.8142166137695312,
                            41.94691528969935
                        ],
                        [
                            2.8125858306884766,
                            41.94806436002253
                        ],
                        [
                            2.810354232788086,
                            41.94863888741733
                        ],
                        [
                            2.809152603149414,
                            41.94838354254776
                        ],
                        [
                            2.806062698364258,
                            41.94946875117981
                        ],
                        [
                            2.8063201904296875,
                            41.94844737886103
                        ],
                        [
                            2.8055477142333984,
                            41.94857505129582
                        ],
                        [
                            2.8049468994140625,
                            41.949660256667755
                        ],
                        [
                            2.80426025390625,
                            41.948958067066
                        ],
                        [
                            2.8032302856445312,
                            41.94870272347492
                        ],
                        [
                            2.8032302856445312,
                            41.9492134096343
                        ],
                        [
                            2.802286148071289,
                            41.949724091702535
                        ],
                        [
                            2.8049468994140625,
                            41.95406472410133
                        ],
                        [
                            2.803316116333008,
                            41.955532812279756
                        ],
                        [
                            2.8031444549560547,
                            41.95680938320771
                        ],
                        [
                            2.798337936401367,
                            41.95814975516194
                        ],
                        [
                            2.7991104125976562,
                            41.96031982141187
                        ],
                        [
                            2.798337936401367,
                            41.96242599151276
                        ],
                        [
                            2.8000545501708984,
                            41.96325567577159
                        ],
                        [
                            2.800312042236328,
                            41.9659999390434
                        ],
                        [
                            2.8018569946289062,
                            41.9697013162106
                        ],
                        [
                            2.8008270263671875,
                            41.97002039038034
                        ],
                        [
                            2.801084518432617,
                            41.97180717619574
                        ],
                        [
                            2.8003978729248047,
                            41.97193480183611
                        ],
                        [
                            2.8011703491210938,
                            41.97410439859718
                        ],
                        [
                            2.8000545501708984,
                            41.977805304859004
                        ],
                        [
                            2.799968719482422,
                            41.983675266770064
                        ],
                        [
                            2.797822952270508,
                            41.985206472188224
                        ],
                        [
                            2.792329788208008,
                            41.985780664726036
                        ],
                        [
                            2.789154052734375,
                            41.98558926778884
                        ],
                        [
                            2.78310035005595,
                            41.984258328061465
                        ],
                        [
                            2.78310035005595,
                            41.98428889052876
                        ],
                        [
                            2.788209915161133,
                            41.98928950660158
                        ],
                        [
                            2.7979087829589844,
                            41.99573251255606
                        ],
                        [
                            2.8032302856445312,
                            42.000006225986596
                        ],
                        [
                            2.8039169311523438,
                            42.00102677181502
                        ],
                        [
                            2.8070068359375,
                            42.001913018418385
                        ],
                        [
                            2.8070068359375,
                            42.00191973598825
                        ],
                        [
                            2.808809280395508,
                            42.00242999560368
                        ],
                        [
                            2.8125858306884766,
                            41.998028871866495
                        ],
                        [
                            2.8136157989501953,
                            41.99866673474756
                        ],
                        [
                            2.8133583068847656,
                            41.99904944940724
                        ],
                        [
                            2.815675735473633,
                            42.00019757957617
                        ],
                        [
                            2.8196239471435547,
                            42.00134568902976
                        ],
                        [
                            2.8179931640625,
                            42.00417332529288
                        ],
                        [
                            2.8179931640625,
                            42.00408831109371
                        ],
                        [
                            2.8173065185546875,
                            42.005363908982616
                        ],
                        [
                            2.8173065185546875,
                            42.00778747451241
                        ],
                        [
                            2.819538116455078,
                            42.0107849146882
                        ],
                        [
                            2.825632095336914,
                            42.013973525781154
                        ],
                        [
                            2.8273487091064453,
                            42.01588661570966
                        ],
                        [
                            2.8278636932373047,
                            42.01748081335808
                        ],
                        [
                            2.827434539794922,
                            42.02130672466606
                        ],
                        [
                            2.829751968383789,
                            42.02628006523446
                        ],
                        [
                            2.832326889038086,
                            42.02793775897419
                        ],
                        [
                            2.8406524658203125,
                            42.02972291927631
                        ],
                        [
                            2.847003936767578,
                            42.029149123217735
                        ],
                        [
                            2.848634719848633,
                            42.02812902854728
                        ],
                        [
                            2.851552963256836,
                            42.0241122466613
                        ],
                        [
                            2.8488922119140625,
                            42.02130672466606
                        ],
                        [
                            2.849750518798828,
                            42.01990391724706
                        ],
                        [
                            2.848978042602539,
                            42.018883674231546
                        ],
                        [
                            2.8499221801757812,
                            42.01760834744354
                        ],
                        [
                            2.8498363494873047,
                            42.01550400232762
                        ],
                        [
                            2.8487205505371094,
                            42.01263432859156
                        ],
                        [
                            2.846231460571289,
                            42.01027472207946
                        ],
                        [
                            2.847003936767578,
                            42.0079150280354
                        ],
                        [
                            2.850780487060547,
                            42.006767037121335
                        ],
                        [
                            2.8530120849609375,
                            42.00638436887979
                        ],
                        [
                            2.8543853759765625,
                            42.00657570328826
                        ],
                        [
                            2.8579044342041016,
                            42.00504501190807
                        ],
                        [
                            2.860136032104492,
                            42.00561902549143
                        ],
                        [
                            2.8620243072509766,
                            42.00778747451241
                        ],
                        [
                            2.862710952758789,
                            42.007978804701
                        ],
                        [
                            2.863483428955078,
                            42.006894592690344
                        ],
                        [
                            2.8610801696777344,
                            42.00140947228087
                        ],
                        [
                            2.8658008575439453,
                            41.99777372492389
                        ],
                        [
                            2.8661441802978516,
                            41.99649797486623
                        ],
                        [
                            2.8657150268554688,
                            41.99477567172144
                        ],
                        [
                            2.8645992279052734,
                            41.994073979300026
                        ],
                        [
                            2.864856719970703,
                            41.99349986156474
                        ],
                        [
                            2.8682899475097656,
                            41.991649891411925
                        ],
                        [
                            2.875499725341797,
                            41.992415402824065
                        ],
                        [
                            2.8814220428466797,
                            41.99196885561915
                        ],
                        [
                            2.885713577270508,
                            41.99101195820239
                        ],
                        [
                            2.8961849212646484,
                            41.987567008393114
                        ],
                        [
                            2.89823936882732,
                            41.984385573807685
                        ],
                        [
                            2.89823936882732,
                            41.98437421955288
                        ],
                        [
                            2.8659725189208984,
                            41.96759538660669
                        ],
                        [
                            2.8614234924316406,
                            41.96868026812729
                        ],
                        [
                            2.8577327728271484,
                            41.968935531682405
                        ],
                        [
                            2.846403121948242,
                            41.967212482835436
                        ],
                        [
                            2.846403121948242,
                            41.96689339460133
                        ],
                        [
                            2.8391075134277344,
                            41.966638122863316
                        ],
                        [
                            2.838764190673828,
                            41.96625521333851
                        ],
                        [
                            2.8348159790039062,
                            41.96561702568286
                        ],
                        [
                            2.8347301483154297,
                            41.96446827179281
                        ],
                        [
                            2.833099365234375,
                            41.96421299033776
                        ],
                        [
                            2.833099365234375,
                            41.961404826824605
                        ],
                        [
                            2.83447265625,
                            41.95917097201442
                        ],
                        [
                            2.8331851959228516,
                            41.95853271339942
                        ],
                        [
                            2.8342151641845703,
                            41.95751148631874
                        ],
                        [
                            2.8336143493652344,
                            41.95604344371938
                        ],
                        [
                            2.8336143493652344,
                            41.954894517226904
                        ],
                        [
                            2.8343868255615234,
                            41.95380940096615
                        ],
                        [
                            2.8334426879882812,
                            41.95246893772611
                        ],
                        [
                            2.8337860107421875,
                            41.949149574088125
                        ],
                        [
                            2.832670211791992,
                            41.94870272347492
                        ],
                        [
                            2.829580307006836,
                            41.9492134096343
                        ],
                        [
                            2.827777862548828,
                            41.94857505129582
                        ],
                        [
                            2.826662063598633,
                            41.94685145185193
                        ],
                        [
                            2.8265762329101562,
                            41.94327643037303
                        ],
                        [
                            2.826061248779297,
                            41.942318801295045
                        ],
                        [
                            2.8238296508789062,
                            41.94097809642315
                        ],
                        [
                            2.820310592651367,
                            41.94008427751427
                        ],
                        [
                            2.819542295116656,
                            41.9383697734684
                        ],
                        [
                            2.819528366288657,
                            41.9383697734684
                        ],
                        [
                            2.8183364868164062,
                            41.93950967302834
                        ],
                        [
                            2.8179931640625,
                            41.94065887682254
                        ]
                    ]
                ]
                }
            }
            });

            map.addSource("Polvora", {
                type: 'geojson',
                data: {
                    "type": "Feature",
                    "geometry": {
                        "type": "Polygon",
                        "coordinates": [
                    [
                        [
                            2.8441286087036133,
                            41.97866669184123
                        ],
                        [
                            2.84421443939209,
                            41.97876240078671
                        ],
                        [
                            2.844514846801758,
                            41.97882620667042
                        ],
                        [
                            2.8446435928344727,
                            41.978539079690194
                        ],
                        [
                            2.8458023071289062,
                            41.97723104039784
                        ],
                        [
                            2.84646896297127,
                            41.97623983431367
                        ],
                        [
                            2.84646896297127,
                            41.976201753812724
                        ],
                        [
                            2.8458023071289062,
                            41.97592297423856
                        ],
                        [
                            2.843914031982422,
                            41.97404058798256
                        ],
                        [
                            2.8423690795898438,
                            41.973338667002594
                        ],
                        [
                            2.8423261642456055,
                            41.97353010076429
                        ],
                        [
                            2.8421545028686523,
                            41.973370572669495
                        ],
                        [
                            2.840909957885742,
                            41.97295579775309
                        ],
                        [
                            2.840094566345215,
                            41.971966708206224
                        ],
                        [
                            2.839794158935547,
                            41.971424297740356
                        ],
                        [
                            2.8394079208374023,
                            41.971009510149884
                        ],
                        [
                            2.8394508361816406,
                            41.97075425490556
                        ],
                        [
                            2.8388500213623047,
                            41.970690440934646
                        ],
                        [
                            2.838592529296875,
                            41.97053090572766
                        ],
                        [
                            2.8369617462158203,
                            41.97139239109853
                        ],
                        [
                            2.8366613388061523,
                            41.971679550299655
                        ],
                        [
                            2.83597469329834,
                            41.97190289544997
                        ],
                        [
                            2.83571720123291,
                            41.972190052349646
                        ],
                        [
                            2.8350305557250977,
                            41.97263673828709
                        ],
                        [
                            2.834644317626953,
                            41.97270055030813
                        ],
                        [
                            2.8339147567749023,
                            41.97266864430563
                        ],
                        [
                            2.8333139419555664,
                            41.97273245629472
                        ],
                        [
                            2.8331851959228516,
                            41.973211044175144
                        ],
                        [
                            2.83289472223885,
                            41.97376635418918
                        ],
                        [
                            2.83289472223885,
                            41.97378609411053
                        ],
                        [
                            2.835845947265625,
                            41.97400868265129
                        ],
                        [
                            2.8377771377563477,
                            41.975859165445996
                        ],
                        [
                            2.8374338150024414,
                            41.97601868730757
                        ],
                        [
                            2.8371334075927734,
                            41.97646534639435
                        ],
                        [
                            2.8370046615600586,
                            41.97700771393113
                        ],
                        [
                            2.836790084838867,
                            41.97719913666484
                        ],
                        [
                            2.836446762084961,
                            41.977805304859004
                        ],
                        [
                            2.836446762084961,
                            41.97799672519531
                        ],
                        [
                            2.836318016052246,
                            41.97812433843319
                        ],
                        [
                            2.836275100708008,
                            41.97882620667042
                        ],
                        [
                            2.836146354675293,
                            41.979017623938034
                        ],
                        [
                            2.838420867919922,
                            41.97975138480024
                        ],
                        [
                            2.8385496139526367,
                            41.97984709211545
                        ],
                        [
                            2.8391075134277344,
                            41.97975138480024
                        ],
                        [
                            2.8391504287719727,
                            41.97962377482287
                        ],
                        [
                            2.8394079208374023,
                            41.97949616458976
                        ],
                        [
                            2.839794158935547,
                            41.979464261991495
                        ],
                        [
                            2.839837074279785,
                            41.97933665143876
                        ],
                        [
                            2.840695381164551,
                            41.97920904063025
                        ],
                        [
                            2.841167449951172,
                            41.97933665143876
                        ],
                        [
                            2.8413820266723633,
                            41.97904952676001
                        ],
                        [
                            2.8417253494262695,
                            41.979017623938034
                        ],
                        [
                            2.842111587524414,
                            41.97914523513009
                        ],
                        [
                            2.8423261642456055,
                            41.97933665143876
                        ],
                        [
                            2.843012809753418,
                            41.97933665143876
                        ],
                        [
                            2.843012809753418,
                            41.97959187228858
                        ],
                        [
                            2.843356132507324,
                            41.97984709211545
                        ],
                        [
                            2.843613624572754,
                            41.97933665143876
                        ],
                        [
                            2.843785285949707,
                            41.97920904063025
                        ],
                        [
                            2.843785285949707,
                            41.978858109588316
                        ],
                        [
                            2.844085693359375,
                            41.97812433843319
                        ],
                        [
                            2.8441286087036133,
                            41.97866669184123
                        ]
                    ]
                ]
                    }
                }
            });

            map.addSource("Montilivi", {
                type: 'geojson',
                data: {
                    "type": "Feature",
                    "geometry": {
                        "type": "Polygon",
                        "coordinates": [
                    [
                        [
                            2.8348325781848516,
                            41.96562842760613
                        ],
                        [
                            2.835372095157664,
                            41.96577556859871
                        ],
                        [
                            2.836790084838867,
                            41.966127576318826
                        ],
                        [
                            2.838764190673828,
                            41.96622330410756
                        ],
                        [
                            2.8386783599853516,
                            41.96651048661076
                        ],
                        [
                            2.8391504287719727,
                            41.96667003188654
                        ],
                        [
                            2.843484878540039,
                            41.96686148569
                        ],
                        [
                            2.844729423522949,
                            41.96698912123938
                        ],
                        [
                            2.8452444076538086,
                            41.96734011768157
                        ],
                        [
                            2.84527554759742,
                            41.96745588434451
                        ],
                        [
                            2.84527554759742,
                            41.967519360162576
                        ],
                        [
                            2.8447723388671875,
                            41.968361187244966
                        ],
                        [
                            2.844257354736328,
                            41.96871217612761
                        ],
                        [
                            2.844085693359375,
                            41.96871217612761
                        ],
                        [
                            2.842583656311035,
                            41.96935033277788
                        ],
                        [
                            2.84121036529541,
                            41.969318425097214
                        ],
                        [
                            2.840867042541504,
                            41.96922270195927
                        ],
                        [
                            2.8403091430664062,
                            41.96922270195927
                        ],
                        [
                            2.8394508361816406,
                            41.96909507088492
                        ],
                        [
                            2.839021682739258,
                            41.96912697867748
                        ],
                        [
                            2.83846378326416,
                            41.96928651740055
                        ],
                        [
                            2.8380346298217773,
                            41.96928651740055
                        ],
                        [
                            2.837390899658203,
                            41.96912697867748
                        ],
                        [
                            2.8370046615600586,
                            41.96912697867748
                        ],
                        [
                            2.8365325927734375,
                            41.96928651740055
                        ],
                        [
                            2.836275100708008,
                            41.96950987094161
                        ],
                        [
                            2.8361892700195312,
                            41.969828946070294
                        ],
                        [
                            2.836318016052246,
                            41.97078616186701
                        ],
                        [
                            2.8359317779541016,
                            41.97199861456039
                        ],
                        [
                            2.8350305557250977,
                            41.97263673828709
                        ],
                        [
                            2.834644317626953,
                            41.97270055030813
                        ],
                        [
                            2.8339147567749023,
                            41.97266864430563
                        ],
                        [
                            2.8333139419555664,
                            41.97273245629472
                        ],
                        [
                            2.8327560424804688,
                            41.97292389187842
                        ],
                        [
                            2.8320695973240855,
                            41.97326341022137
                        ],
                        [
                            2.831742617340563,
                            41.97341055121396
                        ],
                        [
                            2.8312110900878906,
                            41.973657722952424
                        ],
                        [
                            2.8304386138916016,
                            41.97381725032804
                        ],
                        [
                            2.8282928466796875,
                            41.973785344884874
                        ],
                        [
                            2.8267478942871094,
                            41.97416820914782
                        ],
                        [
                            2.8249454498291016,
                            41.9748701209858
                        ],
                        [
                            2.824559211730957,
                            41.9741363038805
                        ],
                        [
                            2.8243446350097656,
                            41.973498195177285
                        ],
                        [
                            2.8243446350097656,
                            41.972572926202105
                        ],
                        [
                            2.8240442276000977,
                            41.96963750118485
                        ],
                        [
                            2.8235721588134766,
                            41.967723020685696
                        ],
                        [
                            2.8266191482543945,
                            41.96734011768157
                        ],
                        [
                            2.827005386352539,
                            41.96587230151226
                        ],
                        [
                            2.827777862548828,
                            41.965968029684575
                        ],
                        [
                            2.828035354614258,
                            41.9658084826508
                        ],
                        [
                            2.828679084777832,
                            41.96590421091901
                        ],
                        [
                            2.8289365768432617,
                            41.96478737217328
                        ],
                        [
                            2.8291940689086914,
                            41.96475546220711
                        ],
                        [
                            2.8296661376953125,
                            41.96494692176415
                        ],
                        [
                            2.8314685821533203,
                            41.96446827179281
                        ],
                        [
                            2.831854820251465,
                            41.964053438908934
                        ],
                        [
                            2.832026481628418,
                            41.9634790504569
                        ],
                        [
                            2.8328847885131836,
                            41.963638603324114
                        ],
                        [
                            2.8330564498901367,
                            41.96335140787548
                        ],
                        [
                            2.833099365234375,
                            41.96421299033776
                        ],
                        [
                            2.8342151641845703,
                            41.96424490057558
                        ],
                        [
                            2.8347301483154297,
                            41.964436361666884
                        ],
                        [
                            2.83483873704188,
                            41.964624759884714
                        ],
                        [
                            2.83483873704188,
                            41.96510937226592
                        ],
                        [
                            2.8348325781848516,
                            41.96562842760613
                        ]
                    ]
                ]
                    }
                }
            });

            

          


            // add a sky layer that will show when the map is highly pitched

            map.addLayer({
                'id': 'fill-Onyar',
                'type': 'line',
                'renderingMode': '2d',
                'source': 'Onyar',
                'layout': {
                    'line-join': 'round',
                    'line-cap': 'round',
                    'line-round-limit': 0.5
                    },
                'paint': {
                    "line-color": 'rgb(0,155,219)',
                    "line-width": 20,
                    "line-opacity": 0

                }
            },'settlement-subdivision-label');
            
            map.addLayer({
                'id': 'fill-Girona',
                'type': 'fill',
                'renderingMode': '2d',
                'source': 'Girona',
                'paint': {
                    "fill-color": "black",
                    "fill-opacity": 0,

                }
            },'settlement-subdivision-label');
            
            map.addLayer({
                'id': 'border-Girona',
                'type': 'line',
                'renderingMode': '2d',
                'source': 'Girona',
                'paint': {
                    "line-color": "white",
                    "line-width": 3,
                    "line-opacity": 0,

                }
            },'settlement-subdivision-label');

            map.addLayer({
                'id': 'border-GironaFi',
                'type': 'line',
                'renderingMode': '2d',
                'source': 'Girona',
                'paint': {
                    "line-color": "white",
                    "line-width": 1,
                    "line-opacity": 0,

                }
            },'settlement-subdivision-label');

            map.addLayer({
                'id': 'fill-Polvora',
                'type': 'fill',
                'renderingMode': '2d',
                'source': 'Polvora',
                'paint': {
                    "fill-color": "#e3e6f8",
                    "fill-opacity": 0,

                }
            },'settlement-subdivision-label');

            map.addLayer({
                'id': 'border-Polvora',
                'type': 'line',
                'renderingMode': '2d',
                'source': 'Polvora',
                'paint': {
                    "line-color": "white",
                    "line-width": 3,
                    "line-opacity": 0,

                }
            },'settlement-subdivision-label');

            map.addLayer({
                'id': 'fill-Montilivi',
                'type': 'fill',
                'renderingMode': '2d',
                'source': 'Montilivi',
                'paint': {
                    "fill-color": "#001c4c",
                    "fill-opacity": 0,

                }
            },'settlement-subdivision-label');

            map.addLayer({
                'id': 'border-Montilivi',
                'type': 'line',
                'renderingMode': '2d',
                'source': 'Montilivi',
                'paint': {
                    "line-color": "white",
                    "line-width": 3,
                    "line-opacity": 0,

                }
            },'settlement-subdivision-label');

            
            
           

            map.addControl(new mapboxgl.Minimap({
                id: "mapboxgl-minimap",
                width: isMobile ? '15vh' : "20vh",
                height: isMobile ? '15vh' : "20vh",
                style: "mapbox://styles/laur05/clbuqkfry008314n54pr88xgi",
                lineColor: "black",
                lineWidth: 4,
                lineOpacity: 1,
                fillColor: "rgb(0,155,219, 0)",
                fillOpacity: 0.25,
                center: [1.94990, 41.75821  ], 
                zoomLevels: [],

                zoom: 5,
                //zoomAdjust: null,
                scrollZoom: false,
               // boxZoom: true,



                //boxZoom: true,

                //dragPan: false,

            }), 'bottom-right');

           // map.addControl(
               // new MapboxGeocoder({
               // accessToken: mapboxgl.accessToken,
               // mapboxgl: mapboxgl,
                //placeholder: 'Busca tu calle',
                //zoom: 7,
                //})
                //);



            // setup the instance, pass callback functions
            scroller
                .setup({
                    step: '.step',
                    offset:  isMobile ? 0.7 : 0.5,
                    progress: true,
                    debug: false
                })
                .onStepEnter(response => {
                    var chapter = config.chapters.find(chap => chap.id === response.element.id);
                    response.element.classList.add('active');
                    map[chapter.mapAnimation || 'flyTo'](chapter.location);
                    if (config.showMarkers) {
                        marker.setLngLat(chapter.location.center);
                    }
                    if (chapter.onChapterEnter.length > 0) {
                        chapter.onChapterEnter.forEach(setLayerOpacity);
                    }
                    if (chapter.callback) {
                        window[chapter.callback]();
                    }
                    if (chapter.rotateAnimation) {
                        map.once('moveend', function () {
                            const rotateNumber = map.getBearing();
                            map.rotateTo(rotateNumber + 90, {
                                duration: 24000, easing: function (t) {
                                    return t;
                                }
                            });
                        });
                    }
                })
                .onStepExit(response => {
                    var chapter = config.chapters.find(chap => chap.id === response.element.id);
                    response.element.classList.remove('active');
                    if (chapter.onChapterExit.length > 0) {
                        chapter.onChapterExit.forEach(setLayerOpacity);
                    }
                });
        });

        // setup resize event
        window.addEventListener('resize', scroller.resize);

    </script>
</body>
</html>